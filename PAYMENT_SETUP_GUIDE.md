# 扫码支付配置指南

## 功能说明

卡密商店已升级为扫码支付模式，用户需要扫码支付后才能生成卡密。

## 当前配置状态

✅ **微信收款码**：已配置 (`/public/payment-wechat.png`)
⚠️ **支付宝收款码**：未配置（可选）

## 配置步骤

### 1. 准备收款码

你需要准备以下收款码图片（至少一个）：

- 微信收款码（可选）
- 支付宝收款码（可选）

**如何获取收款码：**

**微信支付：**
1. 打开微信
2. 点击"我" → "服务" → "收付款"
3. 点击"收款码"
4. 保存收款码图片

**支付宝：**
1. 打开支付宝
2. 点击"收钱"
3. 保存收款码图片

### 2. 配置收款码图片

将收款码图片放到 `/public` 目录下，并重命名：

- 微信收款码：`payment-wechat.png` 或 `payment-wechat.jpg`
- 支付宝收款码：`payment-alipay.png` 或 `payment-alipay.jpg`

**示例目录结构：**
```
/public
├── payment-wechat.png     # 微信收款码
├── payment-alipay.png     # 支付宝收款码
└── favicon.ico
```

### 3. 自定义配置（可选）

如果使用不同的文件名，修改 `src/lib/payment-config.ts`：

```typescript
export const paymentConfig = {
  wechatQRCode: '/你的微信收款码路径.png',
  alipayQRCode: '/你的支付宝收款码路径.jpg',
  // ...
};
```

### 4. 重启服务

配置完成后，重启开发服务器：

```bash
coze dev
```

## 支付流程

### 用户端流程

1. 用户在商店选择套餐
2. 点击"立即购买"按钮
3. 确认订单信息
4. 点击"去支付"按钮
5. 系统显示收款码二维码
6. 用户扫码支付
7. 支付完成后点击"我已支付"按钮
8. 系统生成并显示卡密
9. 用户复制卡密并在写小说应用中激活

### 开发者管理

**查看订单：**
- 收款后，用户点击"我已支付"
- 系统自动生成卡密
- 你可以在微信/支付宝的交易记录中查看收款

**注意事项：**
- 当前为手动确认模式（用户点击"我已支付"）
- 建议定期核对微信/支付宝收款记录
- 如有异常情况，可以联系用户核实

## 收款码图片要求

- **格式**：PNG、JPG、GIF
- **尺寸**：建议 300x300 像素
- **清晰度**：确保二维码清晰可扫描
- **大小**：建议不超过 500KB

## 常见问题

### 1. 收款码不显示

**原因：**
- 图片文件不存在
- 文件名不匹配
- 图片格式不支持

**解决方法：**
- 检查 `/public` 目录下是否有对应的收款码图片
- 确认文件名与配置一致
- 确保图片格式正确（PNG/JPG）

### 2. 收款码无法扫描

**原因：**
- 图片模糊
- 收款码太小
- 二维码损坏

**解决方法：**
- 使用高清收款码图片
- 确保收款码尺寸足够大（至少 300x300）
- 重新生成收款码

### 3. 只显示占位符

**原因：**
- 未配置收款码图片
- 配置路径错误

**解决方法：**
- 按照步骤2配置收款码
- 检查配置文件中的路径是否正确

## 进阶功能（可选）

### 添加支付验证

如需增加支付验证，可以：

1. 用户上传支付截图
2. 管理员后台审核
3. 审核通过后生成卡密

### 接入真实支付系统

如需接入自动化的支付系统，可以考虑：

- **Stripe**：国际通用，支持信用卡
- **微信支付API**：需要申请商户号
- **支付宝API**：需要申请商户号

## 安全建议

1. 定期检查收款记录
2. 记录异常订单
3. 及时处理用户反馈
4. 保留收款凭证

## 技术支持

如有问题，请检查：

1. 浏览器控制台是否有错误
2. 收款码图片是否正确加载
3. 配置文件是否正确

## 更新日志

- **v1.0** - 实现扫码支付功能
  - 支持微信支付
  - 支持支付宝
  - 自动生成卡密
